
library(flexdashboard)
library(knitr)
library(DT)
library(rpivotTable)
library(ggplot2)
library(plotly)
library(dplyr)
library(openintro)
library(highcharter)
library(ggvis)
library(highcharter)



# Set highcharter options
options(highcharter.theme = hc_theme_smpl(tooltip = list(valueDecimals = 2)))
data_melt <-  read.csv("df_melt.csv", header = TRUE,  sep = ",")
df <- read.csv("df.csv",header = TRUE)




# Pie chart of all variable

hc <- data_melt %>% 
  hchart("pie", hcaes(x = variable, y = value ),
         name = "Fruit consumption")

hc





#pie chart specimen type in each project
ggplot(data=data_melt, aes(x=" ", y=value, group=variable, colour=variable, fill=variable)) +
  geom_bar(width = 1, stat = "identity") +
  coord_polar("y", start=0) +
  facet_wrap(.~ Year)


  #pie chart specimen type in each project
  ggplot(data=data_melt, aes(x=" ", y=value, group=variable, colour=variable, fill=variable)) +
  geom_bar(width = 1, stat = "identity") +
  coord_polar("y", start=0) + 
  facet_grid(.~ Project) +theme_void()
  
  #data_melt$Year <- factor(data$Year)
  #data_melt$Project <- factor(data_melt$Project)
 # data_melt$variable <- factor(data_melt$variable)





#barchart each specimen type group by project
ggplot(data_melt,
       aes(x= Project,
           y=value,
           fill = variable)) +
  geom_bar(stat = 'identity',
           position = 'dodge')



  

#Over all specimen type 
p2 <- data_melt %>%
  group_by(variable) %>%
  summarise(sum = sum(value)) %>%
  #filter(count>50) %>%
  plot_ly(labels = ~variable,
          values = ~sum,
          marker = list(colors = mycolors)) %>%
  add_pie(hole = 0.2) %>%
  layout(xaxis = list(zeroline = F,
                      showline = F,
                      showticklabels = F,
                      showgrid = F),
         yaxis = list(zeroline = F,
                      showline = F,
                      showticklabels=F,
                      showgrid=F))
p2







#Over all diag
df_table <- as.data.table(df, keep.rownames = TRUE)
df_table <- select(df,Year,Project,Normal_Tissue,Diseased_Tissue,Not_Specified)
df_table
df8 <-melt(df_table ,id = c("Year","Project"))
df8
  
p3 <- df8 %>%
  group_by(variable) %>%
  summarise(sum = sum(value)) %>%
  #filter(count>50) %>%
  plot_ly(labels = ~variable,
          values = ~sum,
          marker = list(colors = mycolors)) %>%
  add_pie(hole = 0.2) %>%
  layout(xaxis = list(zeroline = F,
                      showline = F,
                      showticklabels = F,
                      showgrid = F),
         yaxis = list(zeroline = F,
                      showline = F,
                      showticklabels=F,
                      showgrid=F))
p3






#line graph specimen type in each year
df9 <-sqldf("SELECT Year,variable,value
            FROM data_melt
            GROUP BY Year,variable")

hc <- df9 %>% 
  hchart('line' , hcaes(x=Year, y=value ,group = variable))

hc

